{% extends "network/layout.html" %}

{% block body %}
{% if user.is_authenticated %}
<!-- create post moved to sidebar modal -->
{% endif %}

<div id="posts-view">
    {% for post in posts %}
    <div class="card">
        <div class="card-header">
            <div class="user-avatar"></div>
            <a href="{% url 'network:profile' post.user.username %}" class="username">{{ post.user.username }}</a>
            {% if user == post.user %}
            <button class="edit-btn btn btn-sm btn-link ml-auto text-secondary" data-id="{{ post.id }}">Edit</button>
            {% endif %}
        </div>

        <div class="card-body">
            {% if post.image %}
            <div class="post-image mb-3">
                <img src="{{ post.image.url }}" alt="Post Image">
            </div>
            {% endif %}

            <div class="action-bar">
                {% if user.is_authenticated %}
                <i class="{% if user in post.likes.all %}fas liked{% else %}far{% endif %} fa-heart action-icon like-btn"
                    data-id="{{ post.id }}"></i>
                <i class="far fa-comment action-icon comment-toggle-btn" data-id="{{ post.id }}"></i>
                {% else %}
                <i class="far fa-heart action-icon"></i>
                <i class="far fa-comment action-icon"></i>
                {% endif %}
                <i class="far fa-paper-plane action-icon"></i>
            </div>

            <span class="likes-count"><span id="like-count-{{ post.id }}">{{ post.likes.count }}</span> likes</span>

            <div id="post-content-{{ post.id }}">
                <p class="caption">
                    <a href="{% url 'network:profile' post.user.username %}" class="username">
                        {{ post.user.username }}
                    </a>
                    {{ post.content }}
                </p>
            </div>

            <!-- comments section -->
            <div class="comments-section mt-2">
                {% if post.comments.count > 0 %}
                <div class="text-muted small mb-1 view-comments-btn" data-id="{{ post.id }}" style="cursor: pointer;">
                    <i class="far fa-comments"></i> Comments ({{ post.comments.count }})
                </div>
                {% endif %}
                <!-- removed display:none to fix disappearing issue -->
                <div class="comments-list" id="comments-list-{{ post.id }}">
                    {% for comment in post.comments.all %}
                    <div class="comment small mb-1">
                        <strong>{{ comment.user.username }}</strong> {{ comment.content }}
                    </div>
                    {% endfor %}
                </div>
                <!-- new comment input - hidden by default or visible? instagram usually has it visible or behind click -->
                <!-- let's make it visible but stylized -->
                {% if user.is_authenticated %}
                <div class="comment-input-wrapper d-flex align-items-center mt-2" id="comment-input-{{ post.id }}"
                    style="display:none;">
                    <input type="text" class="form-control form-control-sm comment-input"
                        style="border:none; background: transparent; padding-left: 0;" data-id="{{ post.id }}"
                        placeholder="Add a comment...">
                    <button class="btn btn-link btn-sm text-primary post-comment-btn"
                        style="text-decoration: none; font-weight: 600;" data-id="{{ post.id }}">Post</button>
                </div>
                {% endif %}
            </div>
            <div id="edit-area-{{ post.id }}" style="display:none;">
                <textarea id="edit-textarea-{{ post.id }}" class="form-control mb-2">{{ post.content }}</textarea>
                <button class="save-btn btn btn-sm btn-primary" data-id="{{ post.id }}">Save</button>
            </div>

            <span class="timestamp">{{ post.timestamp }}</span>
        </div>
    </div>
    {% endfor %}
</div>

<nav aria-label="Page navigation" class="mt-4 mb-5">
    <ul class="pagination justify-content-center">
        {% if posts.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ posts.previous_page_number }}">Previous</a></li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
        {% endif %}

        {% if posts.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ posts.next_page_number }}">Next</a></li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}
    </ul>
</nav>
{% endblock %}